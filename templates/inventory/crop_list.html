{% extends 'base.html' %}

{% block title %}Mis Cultivos{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Mis Cultivos</h1>
        <a href="{% url 'crop_add' %}" class="btn btn-primary">Agregar Nuevo Cultivo</a>
    </div>

    {% if crops %}
        <div class="crop-list">
            {% for crop in crops %}
                <div class="crop-item">
                    <div class="crop-info">
                        <h3>{{ crop.nombre_producto }}</h3>
                        <p><strong>Cantidad estimada:</strong> {{ crop.cantidad_estimada }} {{ crop.unidad_medida }}</p>
                        <p><strong>Fecha estimada de disponibilidad:</strong> {{ crop.fecha_disponibilidad|date:"d M Y" }}</p>
                        <p><strong>Estado:</strong> <span class="status-badge status-{{ crop.estado|slugify }}">{{ crop.get_estado_display }}</span></p>
                        
                        {% if crop.publicacion %}
                            <p><strong>Publicado en marketplace:</strong> 
                                <a href="{% url 'publication_detail' crop.publicacion.pk %}">Ver publicación</a>
                                {% if crop.publicacion.estado == 'disponible' %}
                                    <span class="status-badge" style="background-color: #28a745;">Disponible</span>
                                {% else %}
                                    <span class="status-badge" style="background-color: #6c757d;">{{ crop.publicacion.get_estado_display }}</span>
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>
                    
                    <div class="crop-actions">
                        <a href="{% url 'crop_edit' crop.pk %}" class="btn-action">Editar</a>
                        
                        {% if crop.estado == 'listo_cosecha' and not crop.publicacion or crop.estado == 'cosechado' and not crop.publicacion %}
                            <a href="{% url 'publication_add' crop.pk %}" class="btn-action btn-publish">Publicar</a>
                        {% elif crop.publicacion %}
                            <a href="{% url 'publication_edit' crop.publicacion.pk %}" class="btn-action">Editar Publicación</a>
                        {% endif %}
                        
                        <a href="{% url 'crop_delete' crop.pk %}" class="btn-action btn-danger" onclick="return confirm('¿Estás seguro de que quieres eliminar este cultivo?')">Eliminar</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>No tienes cultivos registrados</h3>
            <p>Comienza agregando tu primer cultivo para poder venderlo en el marketplace.</p>
            <a href="{% url 'crop_add' %}" class="btn btn-primary">Agregar Primer Cultivo</a>
        </div>
    {% endif %}
{% endblock %}
