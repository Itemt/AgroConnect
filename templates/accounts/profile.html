{% extends 'base.html' %}

{% block title %}Mi Perfil{% endblock %}

{% block content %}
    <div class="profile-container">
        <h1>Mi Perfil</h1>
        
        <div class="profile-card">
            <h2>Información de la Cuenta</h2>
            <p><strong>Nombre de usuario:</strong> {{ user.username }}</p>
            <p><strong>Nombre:</strong> {{ user.first_name }} {{ user.last_name }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Rol:</strong> {{ user.role }}</p>

            {% if user.role == 'Productor' and user.producer_profile %}
                <div class="profile-section">
                    <h3>Perfil de Productor</h3>
                    <p><strong>Ubicación:</strong> {{ user.producer_profile.location }}</p>
                    <p><strong>Descripción de la Finca:</strong> {{ user.producer_profile.farm_description }}</p>
                    <p><strong>Cultivos Principales:</strong> {{ user.producer_profile.main_crops }}</p>
                </div>

                <div class="profile-section">
                    <h3>Mis Cultivos y Publicaciones</h3>
                    {% if crops %}
                        <div class="crop-list">
                            {% for crop in crops %}
                                <div class="crop-item">
                                    <div class="crop-info">
                                        <strong>{{ crop.product.name }}</strong> ({{ crop.estimated_quantity }} {{ crop.unit }})
                                        <span class="status-badge status-{{ crop.status|slugify }}">{{ crop.get_status_display }}</span>
                                    </div>
                                    <div class="crop-actions">
                                        <a href="{% url 'crop_edit' crop.pk %}" class="btn-action">Editar</a>
                                        <a href="{% url 'crop_delete' crop.pk %}" class="btn-action btn-danger">Eliminar</a>
                                        {% if not crop.publication %}
                                            <a href="{% url 'publication_add' crop.pk %}" class="btn-action btn-publish">Publicar</a>
                                        {% else %}
                                            <span class="published-info">Ya Publicado</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>Aún no has registrado ningún cultivo.</p>
                    {% endif %}
                    <a href="{% url 'crop_add' %}" class="btn-add-crop">Añadir Nuevo Cultivo</a>
                </div>

            {% elif user.role == 'Comprador' and user.buyer_profile %}
                <div class="profile-section">
                    <h3>Perfil de Comprador</h3>
                    <p><strong>Nombre de la Compañía:</strong> {{ user.buyer_profile.company_name }}</p>
                    <p><strong>Tipo de Negocio:</strong> {{ user.buyer_profile.business_type }}</p>
                </div>
            {% endif %}

            <a href="{% url 'profile_edit' %}" class="btn-edit">Editar Perfil</a>
        </div>
    </div>
{% endblock %}
