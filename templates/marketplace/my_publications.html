{% extends 'base.html' %}

{% block title %}Mis Publicaciones{% endblock %}

{% block content %}
    <div class="page-header">
        <h1>Mis Publicaciones</h1>
        <a href="{% url 'crop_list' %}" class="btn btn-primary">Ver Cultivos para Publicar</a>
    </div>

    {% if publications %}
        <div class="publications-list">
            {% for publication in publications %}
                <div class="publication-item">
                    <div class="publication-info">
                        <h3>{{ publication.cultivo.nombre_producto }}</h3>
                        <p><strong>Precio por {{ publication.cultivo.unidad_medida }}:</strong> ${{ publication.precio_por_unidad }}</p>
                        <p><strong>Cantidad disponible:</strong> {{ publication.cantidad_disponible }} {{ publication.cultivo.unidad_medida }}</p>
                        <p><strong>Estado del cultivo:</strong> <span class="status-badge status-{{ publication.cultivo.estado|slugify }}">{{ publication.cultivo.get_estado_display }}</span></p>
                        <p><strong>Estado de la publicación:</strong> 
                            {% if publication.estado == 'disponible' %}
                                <span class="status-badge" style="background-color: #28a745;">Disponible</span>
                            {% else %}
                                <span class="status-badge" style="background-color: #6c757d;">{{ publication.get_estado_display }}</span>
                            {% endif %}
                        </p>
                        <p><strong>Creada:</strong> {{ publication.created_at|date:"d M Y" }}</p>
                        
                        {% if publication.descripcion %}
                            <p><strong>Descripción:</strong> {{ publication.descripcion }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="publication-actions">
                        <a href="{% url 'publication_detail' publication.id %}" class="btn btn-info">Ver Detalle</a>
                        <a href="{% url 'publication_edit' publication.pk %}" class="btn btn-secondary">Editar</a>
                        
                        {% if publication.estado == 'disponible' %}
                            <a href="{% url 'publication_delete' publication.pk %}" class="btn btn-danger" 
                               onclick="return confirm('¿Estás seguro de que quieres cambiar el estado de esta publicación?')">
                                Cambiar Estado
                            </a>
                        {% endif %}
                    </div>
                    
                    <div class="publication-stats">
                        <p><strong>Pedidos recibidos:</strong> {{ publication.pedidos.count }}</p>
                        <p><strong>Conversaciones:</strong> {{ publication.conversations.count }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>No tienes publicaciones aún</h3>
            <p>Para crear publicaciones, primero necesitas tener cultivos listos para cosechar.</p>
            <div class="empty-actions">
                <a href="{% url 'crop_add' %}" class="btn btn-primary">Agregar Cultivo</a>
                <a href="{% url 'crop_list' %}" class="btn btn-secondary">Ver Mis Cultivos</a>
            </div>
        </div>
    {% endif %}
{% endblock %}
