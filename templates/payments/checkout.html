{% extends 'base.html' %}
{% load static %}

{% block title %}Checkout - Pagar Pedido #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-3xl mx-auto">
        <!-- Título -->
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-gray-800">Checkout - Pagar Pedido</h2>
            <p class="text-gray-500">Completa tu pago de forma segura con ePayco</p>
        </div>

        <!-- Detalles del pedido -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="bg-gray-800 text-white p-4 rounded-t-lg">
                <h5 class="font-bold text-lg">Detalles del Pedido #{{ order.id }}</h5>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <p><strong>Producto:</strong> {{ order.publicacion.cultivo.nombre }}</p>
                        <p><strong>Cantidad:</strong> {{ order.cantidad_acordada }} {{ order.publicacion.cultivo.unidad_medida }}</p>
                        <p><strong>Precio unitario:</strong> ${{ order.publicacion.precio_por_unidad|floatformat:0 }}</p>
                    </div>
                    <div>
                        <p><strong>Vendedor:</strong> {{ order.vendedor.get_full_name }}</p>
                        <p><strong>Estado:</strong> <span class="bg-yellow-200 text-yellow-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">{{ order.get_estado_display }}</span></p>
                        <p><strong>Fecha:</strong> {{ order.created_at|date:"d/m/Y H:i" }}</p>
                    </div>
                </div>
                <hr class="my-4">
                <div class="text-right">
                    <h4 class="text-xl"><strong>Total a Pagar:</strong> <span class="text-green-600 font-bold">${{ order.precio_total|floatformat:0 }} COP</span></h4>
                </div>
            </div>
        </div>

        <!-- Información de pago -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="bg-blue-600 text-white p-4 rounded-t-lg">
                <h5 class="font-bold text-lg">Información de Pago</h5>
            </div>
            <div class="p-6">
                <p><strong>Referencia:</strong> <code class="bg-gray-200 text-gray-800 rounded px-2 py-1">{{ payment.epayco_ref }}</code></p>
                <p class="text-gray-500 text-sm mt-2">
                    <i class="fas fa-shield-alt mr-1"></i> Tus datos están protegidos con ePayco, una plataforma de pagos segura y certificada.
                </p>
                
                {% if checkout_data.test_mode %}
                <div class="mt-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4" role="alert">
                    <p class="font-bold">Modo de Prueba</p>
                    <p>Este es un pago de prueba. No se realizará un cargo real.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Botón de pago con ePayco -->
        <div class="bg-white rounded-lg shadow-md">
            <div class="p-6 text-center">
                <h5 class="text-xl font-bold mb-4">Selecciona tu método de pago</h5>
                
                <form id="paymentForm" class="mb-4">
                    <script
                        src="https://checkout.epayco.co/checkout.js"
                        class="epayco-button"
                        data-epayco-key="{{ checkout_data.public_key }}"
                        data-epayco-amount="{{ checkout_data.payment_data.amount }}"
                        data-epayco-name="{{ checkout_data.payment_data.name }}"
                        data-epayco-description="{{ checkout_data.payment_data.description }}"
                        data-epayco-currency="{{ checkout_data.payment_data.currency }}"
                        data-epayco-country="{{ checkout_data.payment_data.country }}"
                        data-epayco-test="{{ checkout_data.test_mode|yesno:'true,false' }}"
                        data-epayco-external="false"
                        data-epayco-response="{{ checkout_data.payment_data.response }}"
                        data-epayco-confirmation="{{ checkout_data.payment_data.confirmation }}"
                        data-epayco-name-billing="{{ checkout_data.payment_data.name_billing }}"
                        data-epayco-invoice="{{ checkout_data.payment_data.invoice }}"
                        data-epayco-extra1="{{ checkout_data.payment_data.extra1 }}"
                        data-epayco-extra2="{{ checkout_data.payment_data.extra2 }}"
                        data-epayco-extra3="{{ checkout_data.payment_data.extra3 }}"
                        data-epayco-type-doc-billing="{{ checkout_data.payment_data.type_doc_billing }}"
                        data-epayco-mobilephone-billing="{{ checkout_data.payment_data.mobilephone_billing }}"
                        data-epayco-number-doc-billing="{{ checkout_data.payment_data.number_doc_billing }}"
                        data-epayco-button="Pagar con ePayco"
                    >
                    </script>
                </form>

                <div class="mb-4">
                    <p class="text-gray-500 text-sm">Métodos de pago disponibles:</p>
                    <div class="flex justify-center items-center space-x-4 text-gray-400">
                        <i class="fab fa-cc-visa text-3xl" title="Tarjeta de Crédito"></i>
                        <i class="fab fa-cc-mastercard text-3xl" title="Tarjeta de Crédito"></i>
                        <i class="fas fa-university text-3xl" title="PSE"></i>
                        <i class="fas fa-money-bill-wave text-3xl" title="Efectivo"></i>
                    </div>
                </div>

                <div>
                    <a href="{% url 'order_detail' order.id %}" class="text-gray-600 hover:text-gray-800 font-semibold">
                        <i class="fas fa-arrow-left mr-1"></i> Volver al Pedido
                    </a>
                </div>
            </div>
        </div>

        <!-- Información de seguridad -->
        <div class="mt-6 bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4" role="alert">
            <h6 class="font-bold"><i class="fas fa-info-circle mr-1"></i> Información Importante:</h6>
            <ul class="list-disc list-inside text-sm">
                <li>El pago se procesa de forma segura a través de ePayco</li>
                <li>Recibirás una confirmación por correo electrónico</li>
                <li>El vendedor será notificado automáticamente</li>
                <li>Puedes seguir el estado de tu pedido en tu historial</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

